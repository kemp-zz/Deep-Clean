name: Deep Clean



on:
  workflow_dispatch:

jobs:
  delete-packages:
    runs-on: ubuntu-latest
    steps:
      - name: 显示删除前的磁盘使用情况
        run: |
          echo "▂▂▂▂▂▂▂▂ 删除前磁盘使用情况 ▂▂▂▂▂▂▂▂"
          df -h /

      - name: 删除pip包
        run: |
          echo "▂▂▂▂▂▂▂▂ 开始删除pip包 ▂▂▂▂▂▂▂▂"
          pip_packages=$(pip list --format=freeze)
          echo "$pip_packages" | xargs sudo pip uninstall -y || true

      - name: 删除Debian包
        run: |
          echo "▂▂▂▂▂▂▂▂ 删除Debian包 ▂▂▂▂▂▂▂▂"
          sudo apt-get remove --auto-remove -y attrs

      - name: 删除残留文件
        run: |
          echo "尝试删除残留文件..."
          sudo rm -rf /usr/lib/python3.12/site-packages/attrs*

      - name: 显示删除后的磁盘使用情况
        run: |
          echo "▂▂▂▂▂▂▂▂ 删除后磁盘使用情况 ▂▂▂▂▂▂▂▂"
          df -h /
