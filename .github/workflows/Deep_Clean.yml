name: Deep Clean

name: 查询和清理占用空间的软件

on:
  workflow_dispatch:

jobs:
  disk-cleanup:
    runs-on: ubuntu-latest
    steps:
      - name: 显示删除前的磁盘使用情况
        run: |
          echo "▂▂▂▂▂▂▂▂ 删除前磁盘使用情况 ▂▂▂▂▂▂▂▂"
          df -h /

      - name: 查询占用空间最大的目录
        run: |
          echo "查询占用空间最大的目录..."
          sudo du -h --max-depth=1 / | sort -hr

      - name: 查询/usr目录下占用空间最大的子目录
        run: |
          echo "查询/usr目录下占用空间最大的子目录..."
          sudo du -h --max-depth=1 /usr | sort -hr

      - name: 查询/opt目录下占用空间最大的子目录
        run: |
          echo "查询/opt目录下占用空间最大的子目录..."
          sudo du -h --max-depth=1 /opt | sort -hr

      - name: 查询/mnt目录下占用空间最大的子目录
        run: |
          echo "查询/mnt目录下占用空间最大的子目录..."
          sudo du -h --max-depth=1 /mnt | sort -hr

      - name: 清理不必要的软件或文件
        run: |
          echo "清理不必要的软件或文件..."
          # 删除不必要的软件或文件
          # 例如删除/opt/hostedtoolcache下的某些工具
          sudo rm -rf /opt/hostedtoolcache/CodeQL
          # 删除/mnt下的swapfile
          sudo rm -rf /mnt/swapfile

      - name: 显示删除后的磁盘使用情况
        run: |
          echo "▂▂▂▂▂▂▂▂ 删除后磁盘使用情况 ▂▂▂▂▂▂▂▂"
          df -h /
