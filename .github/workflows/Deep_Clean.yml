name: Deep Clean

on:
  workflow_dispatch:
  schedule:
    - cron: 0 0 * * * # 每天凌晨执行一次

jobs:
  delete-pip-packages:
    runs-on: ubuntu-latest
    steps:
      - name: 环境预检
        run: |
          echo "▂▂▂▂▂▂▂▂ 存储诊断 ▂▂▂▂▂▂▂▂"
          df -h /
          echo "▂▂▂▂▂▂▂▂ 初始状态 ▂▂▂▂▂▂▂▂"

      - name: 查询pip包
        run: |
          echo "▂▂▂▂▂▂▂▂ 查询pip包 ▂▂▂▂▂▂▂▂"
          pip list --format=columns

      - name: 删除pip包
        run: |
          echo "▂▂▂▂▂▂▂▂ 删除pip包 ▂▂▂▂▂▂▂▂"
          pip_packages=$(pip list --format=freeze)
          echo "$pip_packages" | xargs -n1 pip uninstall -y

      - name: 清理验证
        run: |
          echo "▂▂▂▂▂▂▂▂ 最终状态 ▂▂▂▂▂▂▂▂"
          df -h / | awk 'NR==2 {printf "总空间: %s ➔ 可用空间: %s\n", $2, $4}'
