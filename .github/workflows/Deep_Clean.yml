name: Deep Clean

on:
  workflow_dispatch:

jobs:
  delete-packages:
    runs-on: ubuntu-latest
    steps:
      - name: 显示删除前的磁盘使用情况
        run: |
          echo "▂▂▂▂▂▂▂▂ 删除前磁盘使用情况 ▂▂▂▂▂▂▂▂"
          df -h /

      - name: 查询Debian安装的包
        run: |
          echo "查询Debian安装的包..."
          dpkg-query -l | grep attrs || echo "attrs 包未找到"

      - name: 删除Debian安装的attrs包
        run: |
          echo "尝试删除Debian安装的attrs包..."
          sudo dpkg -r --force-depends attrs || echo "无法删除 attrs 包，请检查是否已正确安装"

      - name: 删除残留文件
        run: |
          echo "尝试删除残留文件..."
          sudo rm -rf /usr/lib/python3.12/site-packages/attrs*

      - name: 显示删除后的磁盘使用情况
        run: |
          echo "▂▂▂▂▂▂▂▂ 删除后磁盘使用情况 ▂▂▂▂▂▂▂▂"
          df -h /
